{"version":3,"file":"game.svelte.js","sources":["../../../../src/app/game.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import \"phaser\";\n  import { onMount } from \"svelte\";\n  import { GameModel, gameModel } from \"../gamelogic/gamemodel\";\n  import type { TowerType, TowerInfo } from \"../gamelogic/td/tower_defense\";\n  import Main from \"../scenes/main\";\n  import TD from \"../scenes/td\";\n  let canvas: HTMLCanvasElement, game: any;\n\n  let gameModelInstance: GameModel;\n  gameModel.subscribe((m) => (gameModelInstance = m));\n  \n  onMount(() => {\n    const config: Phaser.Types.Core.GameConfig = {\n      type: Phaser.CANVAS,\n      width: 800,\n      height: 600,\n      physics: {\n        default: 'arcade'\n      },\n      canvas: canvas,\n      scene: [\n        TD,\n        Main,\n      ]\n    };\n    \n    game = new Phaser.Game(config);\n  });\n\n  const toggleTowerSelection = (tower_type: TowerType) => {\n    if (gameModelInstance.tower_defense.selection?.type == tower_type) {\n      gameModelInstance.tower_defense.selection = null\n    } else {\n      gameModelInstance.tower_defense.selectHighestTierForPlacement(tower_type);\n    }\n  }\n\n  function isTower(tower: TowerInfo | undefined | null | string): tower is TowerInfo {\n    return tower ? (tower as TowerInfo).tier !== undefined : false\n  }\n\n  const towerInfo = (tower_id: string) => gameModelInstance.tower_defense.getTower(tower_id)\n\n  $: selection_id = gameModelInstance.tower_defense.selection?.id || null;\n  $: slots = gameModelInstance.tower_defense.slots || []\n  $: slot_tower_info = slots.map(slot_id => slot_id ? towerInfo(slot_id): null)\n\n  type ZippedTowerInfo = [string, TowerInfo | undefined | null]\n  // idk how to define this type but the inferred type is incorrect it seems.\n  $: zipped_slot_id_tower_info = slots.map((s, i) => [s, slot_tower_info[i]])\n\n</script>\n\n<!-- Need to update this. \nShould show a button for each slot, \nif the slot has an id show the associated image for the tower type,\nif the slot does not have an id show an X or something.\nWhen the tower is placed grey out the icon and make it non interactive\nWhen the tower is not placed make the button normal white\nwhen the tower is select highlight the slot with a border.\n\n-->\n\n<div>\n  <canvas bind:this={canvas} id=\"game-container\" />\n  <div class=\"towers\">\n    {#each zipped_slot_id_tower_info as [tower_id, tower_info]}\n      {#if isTower(tower_info)}\n        {tower_info.tier}\n        <button class:active={selection_id === tower_id} class={tower_info.type} on:click={() => toggleTowerSelection(tower_info.type)}></button>\n      {:else if tower_info === null}\n        X <!-- Empty slot -->\n      {:else}\n        BUSTED REEQUIP <!-- Something broke with the ID look up, error state. -->\n      {/if}\n    {/each}\n    <!-- <button class:active={selection === 'basic'} class=\"basic\" on:click={() => toggleTowerSelection('basic')}></button>\n    <button class:active={selection === 'machine_gun'} class=\"machine-gun\" on:click={() => toggleTowerSelection('machine_gun')}></button> -->\n  </div>\n</div>\n\n<style>\n  canvas {\n    width: 800px;\n    height: 600px;\n  }\n  div {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n  }\n  button {\n    border: none;\n    height: 32px;\n    width: 32px;\n  }\n  .basic {\n    background-image: url('static/shotgun.png');\n  }\n  .machine_gun {\n    background-image: url('static/machine_gun.png');\n  }\n  .active {\n\t\tbackground-color: green;\n\t}\n  .towers {\n    display: flex;\n    flex-direction: row;\n    justify-content: left;\n  }\n</style>"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+BAqES,GAAU,KAAC,IAAI;;;;;;;;;;;;;;;;;iFACwC,GAAU,KAAC,IAAI;mDAAjD,GAAY,qBAAK,GAAQ;;;;;;;;;;;;;;0FAD9C,GAAU,KAAC,IAAI;;kIACwC,GAAU,KAAC,IAAI;;;;;oDAAjD,GAAY,qBAAK,GAAQ;;;;;;;;;;;;;;;;;;;8EAF5C,OAAO,gBAAC,GAAU;;qBAGb,GAAU,SAAK,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gDAJxB,GAAyB;;;gCAA9B,MAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+CAAC,GAAyB;;;+BAA9B,MAAI;;;;;;;;;;;;;;;;oCAAJ,MAAI;;;;;;;;;;;;;SA7BC,OAAO,CAAC,KAA4C;QACpD,KAAK,GAAI,KAAmB,CAAC,IAAI,KAAK,SAAS,GAAG,KAAK;;;;;;;;;KAhC5D,MAAyB;KAEzB,iBAA4B;CAChC,SAAS,CAAC,SAAS,CAAE,CAAC,oBAAM,iBAAiB,GAAG,CAAC;;CAEjD,OAAO;QACC,MAAM;GACV,IAAI,EAAE,MAAM,CAAC,MAAM;GACnB,KAAK,EAAE,GAAG;GACV,MAAM,EAAE,GAAG;GACX,OAAO,IACL,OAAO,EAAE,QAAA;GAEH,MAAM;GACd,KAAK,GACH,EAAE,EACF,IAAI;;;MAIG,MAAM,CAAC,IAAI,CAAC,MAAM;;;OAGzB,oBAAoB,GAAI,UAAqB;MAC7C,iBAAiB,CAAC,aAAa,CAAC,SAAS,EAAE,IAAI,IAAI,UAAU;mBAC/D,iBAAiB,CAAC,aAAa,CAAC,SAAS,GAAG,IAAI;;GAEhD,iBAAiB,CAAC,aAAa,CAAC,6BAA6B,CAAC,UAAU;;;;OAQtE,SAAS,GAAI,QAAgB,IAAK,iBAAiB,CAAC,aAAa,CAAC,QAAQ,CAAC,QAAQ;;;;GAuBtE,MAAM;;;;;qCAKsE,oBAAoB,CAAC,UAAU,CAAC,IAAI;;;;oBA1BhI,YAAY,GAAG,iBAAiB,CAAC,aAAa,CAAC,SAAS,EAAE,EAAE,IAAI,IAAI;;;;oBACpE,KAAK,GAAG,iBAAiB,CAAC,aAAa,CAAC,KAAK;;;;oBAC7C,eAAe,GAAG,KAAK,CAAC,GAAG,CAAC,OAAO,IAAI,OAAO,GAAG,SAAS,CAAC,OAAO,IAAG,IAAI;;;;;oBAIzE,yBAAyB,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,eAAe,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;"}