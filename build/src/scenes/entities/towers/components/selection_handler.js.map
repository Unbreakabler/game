{"version":3,"file":"selection_handler.js","sources":["../../../../../../../src/scenes/entities/towers/components/selection_handler.ts"],"sourcesContent":["import { gameModel, GameModel } from \"../../../../gamelogic/gamemodel\";\nimport { OutlinePipeline } from \"../../../../plugins/outline\";\nimport type TD from \"../../../td\";\nimport type Tower from \"../tower\";\nimport type { TowerComponent } from \"./component_interface\";\n\n// Should this be passed down from td.ts instead?\nlet gameModelInstance: GameModel;\ngameModel.subscribe((m) => (gameModelInstance = m));\n\nexport default () => {\n  const tower_component: TowerComponent = {\n    type: 'selection_handler',\n    onInit: (parent: Tower, td_scene: TD, x: number, y:number) => {\n      const width = parent.width ? parent.width : 128;\n      const height = parent.height ? parent.height : 128;\n      const rect = new Phaser.Geom.Rectangle(-(width/2), -(height/2), width, height);\n\n      \n      parent.rotating_sprites?.setInteractive(rect, Phaser.Geom.Rectangle.Contains);\n      parent.static_sprites?.setInteractive(rect, Phaser.Geom.Rectangle.Contains);\n\n      parent.scene.input.on('pointermove', \n        (pointer: Phaser.Input.Pointer, game_objects_under_pointer: Tower[]) => {\n          if (game_objects_under_pointer.length) {\n            for (const obj of game_objects_under_pointer) {\n              if (obj.name === parent.static_sprites?.name || obj.name === parent.rotating_sprites?.name) {\n                if (!parent.selection) {\n                  parent.selection = 'hovered';\n                  document.body.style.cursor = 'pointer';\n                }\n              }\n            }\n          } else {\n            parent.selection = parent.selection === 'hovered' ? undefined : parent.selection;\n            document.body.style.cursor = 'auto';\n          }\n        }\n      )\n\n      parent.scene.input.on('pointerup', \n      (pointer: Phaser.Input.Pointer, game_objects_under_pointer: Tower[]) => {\n        let selected = false;\n        if (game_objects_under_pointer.length) {\n          for (const obj of game_objects_under_pointer) {\n            if (obj.name === parent.static_sprites?.name || obj.name === parent.rotating_sprites?.name) {\n              selected = true;\n            }\n          } \n          if (selected) {\n            gameModelInstance.tower_defense.setSelection(parent.tower_id); \n          }\n        } else {\n          gameModelInstance.tower_defense.setSelection(null);\n        }\n      })\n    },\n    onUpdate: (parent: Tower, time: number, delta: number) => {\n      if (parent.selection) {\n        let already_applied = parent.static_sprites?.getPostPipeline(OutlinePipeline)\n        if (already_applied instanceof Array && !already_applied.length) parent.static_sprites?.setPostPipeline(OutlinePipeline)\n\n        already_applied = parent.rotating_sprites?.getPostPipeline(OutlinePipeline)\n        if (already_applied instanceof Array && !already_applied.length) parent.rotating_sprites?.setPostPipeline(OutlinePipeline)\n      } else {\n        parent.static_sprites?.removePostPipeline(OutlinePipeline);\n        parent.rotating_sprites?.removePostPipeline(OutlinePipeline);\n      }\n    }\n  }\n  return tower_component;\n}"],"names":[],"mappings":"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"}