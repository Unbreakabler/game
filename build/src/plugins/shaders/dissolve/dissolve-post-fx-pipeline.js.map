{"version":3,"file":"dissolve-post-fx-pipeline.js","sources":["../../../../../../src/plugins/shaders/dissolve/dissolve-post-fx-pipeline.ts"],"sourcesContent":["import FragSrc from './dissolve-frag.js';\n\nconst GetValue = Phaser.Utils.Objects.GetValue;\nconst Clamp = Phaser.Math.Clamp;\n\nexport default class DissolvePostFxPipeline extends Phaser.Renderer.WebGL.Pipelines.PostFXPipeline {\n\n    private _progress: number = 0;\n\n    public toFrame: Phaser.Textures.Frame | undefined = undefined;\n    public toTexture: string | null = '__DEFAULT';\n    public targetTexture: WebGLTexture | undefined = undefined;\n    public resizeMode: ResizeMode = ResizeMode.contain;\n    public toRatio: number = 1;\n    public noiseX: number = 0;\n    public noiseY: number = 0;\n    public noiseZ: number = 0;\n    public fromEdgeStart: number = 0.01;\n    public fromEdgeWidth: number = 0.05;\n    public toEdgeStart: number = 0.01;\n    public toEdgeWidth: number = 0.05;\n\n    constructor(game: Phaser.Game) {\n        super({\n            name: 'DissolvePostFX',\n            game: game,\n            renderTarget: true,\n            fragShader: FragSrc\n        });\n    }\n\n    resetFromJSON(o: object) {\n        this.setTransitionTargetTexture(GetValue(o, 'toTexture', '__DEFAULT'), GetValue(o, 'toFrame', undefined), GetValue(o, 'resizeMode', 1));\n        this.setNoise(GetValue(o, 'noiseX', undefined), GetValue(o, 'noiseY', undefined), GetValue(o, 'noiseZ', undefined));\n        this.setFromEdge(GetValue(o, 'fromEdgeStart', 0.01), GetValue(o, 'fromEdgeWidth', 0.05));\n        this.setToEdge(GetValue(o, 'toEdgeStart', 0.01), GetValue(o, 'toEdgeWidth', 0.05));\n        return this;\n    }\n\n    onBoot() {\n        this.setTransitionTargetTexture();\n    }\n\n    onPreRender() {\n        this.set1f('progress', this.progress);\n        this.set1i('resizeMode', this.resizeMode);\n\n        this.set1f('noiseX', this.noiseX);\n        this.set1f('noiseY', this.noiseY);\n        this.set1f('noiseZ', this.noiseZ);\n        this.set1f('fromEdgeStart', this.fromEdgeStart);\n        this.set1f('fromEdgeWidth', this.fromEdgeWidth);\n        this.set1f('toEdgeStart', this.toEdgeStart);\n        this.set1f('toEdgeWidth', this.toEdgeWidth);\n    }\n\n    onDraw(renderTarget: Phaser.Renderer.WebGL.RenderTarget) {\n        this.set1f('fromRatio', renderTarget.width / renderTarget.height);\n\n        this.bindTexture(this.targetTexture, 1);\n\n        this.bindAndDraw(renderTarget);\n    }\n\n    get progress() {\n        return this._progress;\n    }\n\n    set progress(value) {\n        this._progress = Clamp(value, 0, 1);\n    }\n\n    setProgress(value: number) {\n        this.progress = value;\n        return this;\n    }\n\n    setTransitionTargetTexture(key?: string, frame?: string, resizeMode?: ResizeMode) {\n        if (key === undefined) {\n            key = '__DEFAULT';\n        }\n        var phaserTexture = this.game.textures.getFrame(key, frame);\n\n        if (!phaserTexture) {\n            phaserTexture = this.game.textures.getFrame('__DEFAULT');\n        }\n\n        this.toRatio = phaserTexture.width / phaserTexture.height;\n\n        this.toFrame = phaserTexture;\n        this.targetTexture = phaserTexture.glTexture;\n\n        if (resizeMode !== undefined) {\n            this.resizeMode = resizeMode;\n        }\n\n        this.set1i('uMainSampler2', 1);\n        this.set1f('toRatio', this.toRatio);\n\n        return this;\n    }\n\n    setResizeMode(mode: ResizeMode) {\n        this.resizeMode = mode;\n        return this;\n    }\n\n    setNoise(x?: number, y?: number, z?: number) {\n        if (x === undefined) {\n            x = 4 + Math.random() * 6;\n        }\n        if (y === undefined) {\n            y = 4 + Math.random() * 6;\n        }\n        if (z === undefined) {\n            z = Math.random() * 10;\n        }\n        this.noiseX = x;\n        this.noiseY = y;\n        this.noiseZ = z;\n        return this;\n    }\n\n    setFromEdge(edgeStart: number, edgeWidth: number) {\n        this.fromEdgeStart = edgeStart;\n        this.fromEdgeWidth = edgeWidth;\n        return this;\n    }\n\n    setToEdge(edgeStart: number, edgeWidth: number) {\n        this.toEdgeStart = edgeStart;\n        this.toEdgeWidth = edgeWidth;\n        return this;\n    }\n}\n\n/**\n * Set the resize mode of the target texture.\n * \n * Can be either:\n * \n * 0 - Stretch. The target texture is stretched to the size of the source texture.\n * 1 - Contain. The target texture is resized to fit the source texture. This is the default.\n * 2 - Cover. The target texture is resized to cover the source texture.\n * \n * If the source and target textures are the same size, then use a resize mode of zero\n * for speed.\n *\n */\nenum ResizeMode {\n    stretch,\n    contain,\n    cover,\n}\n"],"names":["FragSrc"],"mappings":"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"}