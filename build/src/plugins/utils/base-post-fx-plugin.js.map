{"version":3,"file":"base-post-fx-plugin.js","sources":["../../../../../src/plugins/utils/base-post-fx-plugin.ts"],"sourcesContent":["const SpliceOne = Phaser.Utils.Array.SpliceOne;\n\nclass BasePostFxPipelinePlugin extends Phaser.Plugins.BasePlugin {\n\n  public PostFxPipelineClass!: Phaser.Renderer.WebGL.Pipelines.PostFXPipeline;\n  public postFxPipelineName!: string;\n\n  public setPostPipelineClass(PostFxPipelineClass: Phaser.Renderer.WebGL.Pipelines.PostFXPipeline, postFxPipelineName: string) {\n    this.PostFxPipelineClass = PostFxPipelineClass;\n    this.postFxPipelineName = postFxPipelineName;\n    return this;\n  }\n\n  public start() {\n    var eventEmitter = this.game.events;\n    eventEmitter.on('destroy', this.destroy, this);\n\n    // Odd that the docs for `addPostPipeline` say to pass a class as the second param, \n    // but doing so causes a type error leading to this weird type casting.\n    (this.game.renderer as Phaser.Renderer.WebGL.WebGLRenderer).pipelines.addPostPipeline(this.postFxPipelineName, (this.PostFxPipelineClass as unknown) as Function);\n  }\n\n  public add(gameObject: Phaser.GameObjects.Sprite, config?: any) {\n    if (config === undefined) {\n      config = {};\n    }\n\n    gameObject.setPostPipeline(this.PostFxPipelineClass);\n    var pipeline = gameObject.postPipelines[gameObject.postPipelines.length - 1];\n    (pipeline as any).resetFromJSON(config);\n\n    if (config.name) {\n      pipeline.name = config.name;\n    }\n\n    return pipeline;\n  }\n\n  public remove(gameObject: Phaser.GameObjects.Sprite, name: string | undefined) {\n    if (name === undefined) {\n      var pipelines = gameObject.postPipelines;\n      for (var i = (pipelines.length - 1); i >= 0; i--) {\n        var instance = pipelines[i];\n        if (instance instanceof (this.PostFxPipelineClass as any)) {\n          instance.destroy();\n          SpliceOne(pipelines, i);\n        }\n      }\n    } else {\n      var pipelines = gameObject.postPipelines;\n      for (var i = 0, cnt = pipelines.length; i < cnt; i++) {\n        var instance = pipelines[i];\n        if ((instance instanceof (this.PostFxPipelineClass as any)) && (instance.name === name)) {\n          instance.destroy();\n          SpliceOne(pipelines, i);\n        }\n      }\n    }\n  }\n\n  public get(gameObject: Phaser.GameObjects.Sprite, name: string | undefined) {\n    if (name === undefined) {\n      var result = [];\n      var pipelines = gameObject.postPipelines;\n      for (var i = 0, cnt = pipelines.length; i < cnt; i++) {\n        var instance = pipelines[i];\n        if (instance instanceof (this.PostFxPipelineClass as any)) {\n          result.push(instance)\n        }\n      }\n      return result;\n    } else {\n      var pipelines = gameObject.postPipelines;\n      for (var i = 0, cnt = pipelines.length; i < cnt; i++) {\n        var instance = pipelines[i];\n        if ((instance instanceof (this.PostFxPipelineClass as any)) && (instance.name === name)) {\n          return instance;\n        }\n      }\n    }\n    return;\n  }\n}\n\nexport default BasePostFxPipelinePlugin;"],"names":[],"mappings":"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"}