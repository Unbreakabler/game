{"version":3,"file":"farmjob.js","sources":["../../../../../src/gamelogic/village/farmjob.ts"],"sourcesContent":["import { Exclude, Expose } from \"class-transformer\";\nimport type { Wallet } from \"../gamemodel\";\nimport type { Requirement } from \"./achievable\";\nimport type { FARM_JOB } from \"./farmjobs\";\nimport { Achievable } from \"./achievable\";\n\n@Exclude()\nexport class FarmJob extends Achievable {\n  //TODO add some way to make it active  at reduced rrate when you unlock the helper\n\n  public display_name: string;\n  public description: string;\n\n  public difficulty_growth_factor: number;\n  //exp gained per second\n  public base_exp_rate: number;\n  //base income gained per second. affected by income growth factor\n  public base_income: number;\n  //time in seconds per level. affected by level and income growth factor\n  //level 0 with income_growth_factor of 1 will take base_time_per_level seconds to level.\n  public base_exp_per_level: number;\n\n  //Saveable Members\n  @Expose() public active: boolean = false;\n  @Expose() public current_exp: number = 0;\n  @Expose() public max_level: number = 0;\n\n  public constructor(\n    short_name: FARM_JOB,\n    requirements: Requirement[],\n    display_name: string,\n    description: string,\n    difficulty_growth_factor: number,\n    base_exp_rate: number = 1,\n    base_income: number = 1,\n    base_time_per_level: number = 5,\n    start_level: number = 0,\n  ) {\n    super(short_name, requirements, start_level);\n    this.display_name = display_name;\n    this.description = description;\n    this.difficulty_growth_factor = difficulty_growth_factor;\n    this.base_exp_rate = base_exp_rate;\n    this.base_income = base_income;\n    this.base_exp_per_level = base_time_per_level;\n  }\n\n  public getDisplayName(): string {\n    return this.display_name;\n  }\n  public getCurrentLevel(): number {\n    return this.level;\n  }\n\n  public getMaxLevelReached(): number {\n    return this.max_level;\n  }\n\n  /**\n   * https://www.desmos.com/calculator/lor4dbrqdz\n   * formula 5\n   **/\n  public getTotalExpToNextLevel(): number {\n    //prettier-ignore\n    return this.difficulty_growth_factor *\n    (this.base_exp_per_level + 10 * Math.log(Math.pow(10, this.level / 10))) *\n    1 / ((this.max_level + 10)/ 10);\n  }\n\n  /**\n   *  https://www.desmos.com/calculator/lor4dbrqdz\n   *  formula 2\n   */\n  public getCurrentIncome(): number {\n    const g = this.difficulty_growth_factor;\n    //prettier-ignore\n    const result = this.base_income * g + \n    0.5 * Math.pow(Math.log(Math.pow(g, g) * this.level + 1), 2) +\n    2 * g * Math.pow(g - 1, 2);\n    return result / 10;\n  }\n\n  public getCurrentExpRate(): number {\n    return this.base_exp_rate;\n  }\n\n  public update(delta_t_s: number): void {\n    if (!this.active) return;\n    const exp_gained = delta_t_s * this.getCurrentExpRate();\n    this.current_exp += exp_gained;\n\n    //apply exp until no more level ups\n    while (this.current_exp > this.getTotalExpToNextLevel()) {\n      this.current_exp -= this.getTotalExpToNextLevel();\n      this.level++;\n    }\n  }\n\n  public earnIncome(wallet: Wallet, delta_t_s: number): void {\n    if (!this.active) return;\n    wallet.money += this.getCurrentIncome() * delta_t_s;\n  }\n}\n"],"names":[],"mappings":";;;;;IAOa,OAAO,GAApB,MAAa,OAAQ,SAAQ,UAAU;IAoBrC,YACE,UAAoB,EACpB,YAA2B,EAC3B,YAAoB,EACpB,WAAmB,EACnB,wBAAgC,EAChC,gBAAwB,CAAC,EACzB,cAAsB,CAAC,EACvB,sBAA8B,CAAC,EAC/B,cAAsB,CAAC;QAEvB,KAAK,CAAC,UAAU,EAAE,YAAY,EAAE,WAAW,CAAC,CAAC;;QAf9B,WAAM,GAAY,KAAK,CAAC;QACxB,gBAAW,GAAW,CAAC,CAAC;QACxB,cAAS,GAAW,CAAC,CAAC;QAcrC,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QACjC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,wBAAwB,GAAG,wBAAwB,CAAC;QACzD,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;QACnC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,kBAAkB,GAAG,mBAAmB,CAAC;KAC/C;IAEM,cAAc;QACnB,OAAO,IAAI,CAAC,YAAY,CAAC;KAC1B;IACM,eAAe;QACpB,OAAO,IAAI,CAAC,KAAK,CAAC;KACnB;IAEM,kBAAkB;QACvB,OAAO,IAAI,CAAC,SAAS,CAAC;KACvB;;;;;IAMM,sBAAsB;;QAE3B,OAAO,IAAI,CAAC,wBAAwB;aACnC,IAAI,CAAC,kBAAkB,GAAG,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC,CAAC,CAAC;YACxE,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,GAAG,EAAE,IAAG,EAAE,CAAC,CAAC;KACjC;;;;;IAMM,gBAAgB;QACrB,MAAM,CAAC,GAAG,IAAI,CAAC,wBAAwB,CAAC;;QAExC,MAAM,MAAM,GAAG,IAAI,CAAC,WAAW,GAAG,CAAC;YACnC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;YAC5D,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;QAC3B,OAAO,MAAM,GAAG,EAAE,CAAC;KACpB;IAEM,iBAAiB;QACtB,OAAO,IAAI,CAAC,aAAa,CAAC;KAC3B;IAEM,MAAM,CAAC,SAAiB;QAC7B,IAAI,CAAC,IAAI,CAAC,MAAM;YAAE,OAAO;QACzB,MAAM,UAAU,GAAG,SAAS,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACxD,IAAI,CAAC,WAAW,IAAI,UAAU,CAAC;;QAG/B,OAAO,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,sBAAsB,EAAE,EAAE;YACvD,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,sBAAsB,EAAE,CAAC;YAClD,IAAI,CAAC,KAAK,EAAE,CAAC;SACd;KACF;IAEM,UAAU,CAAC,MAAc,EAAE,SAAiB;QACjD,IAAI,CAAC,IAAI,CAAC,MAAM;YAAE,OAAO;QACzB,MAAM,CAAC,KAAK,IAAI,IAAI,CAAC,gBAAgB,EAAE,GAAG,SAAS,CAAC;KACrD;EACF;AA/EW;IAAT,MAAM,EAAE;uCAAgC;AAC/B;IAAT,MAAM,EAAE;4CAAgC;AAC/B;IAAT,MAAM,EAAE;0CAA8B;AAlB5B,OAAO;IADnB,OAAO,EAAE;GACG,OAAO,CA+FnB;;;;"}