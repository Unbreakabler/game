{"version":3,"file":"mine.js","sources":["../../../../../src/gamelogic/village/mine.ts"],"sourcesContent":["import { Exclude, Expose } from \"class-transformer\";\nimport type { Resources, Wallet } from \"../gamemodel\";\nimport type { IIndexable } from \"../td/stats_tower_modifiers\";\nimport { Achievable } from \"./achievable\";\nimport type { MINE } from \"./mines\";\nimport type { Upgrade } from \"./villagebuildings\";\n\nexport class Mine extends Achievable {\n  @Exclude() public display_name: string;\n  @Exclude() public description: string;\n  @Exclude() public upgrades: Upgrade[];\n\n  @Exclude() public difficulty_growth_factor: number = 1;\n  @Exclude() public base_gold_per_level: number = 10;\n\n  //Saveable Members\n  @Expose() public active: boolean = false; // Whether the mine is enabled or not.\n  @Expose() public current_timer_ms: number = 0;\n  @Expose() public mine_timer_ms: number = 4_000; // time to complete a round of mining\n  @Expose() public production: number; // number of resources mined each round\n  @Expose() public production_multiplier: number;\n\n  public constructor(\n    short_name: MINE, \n    upgrades: Upgrade[], \n    display_name: string, \n    description: string,\n    production: number = 1,\n    production_multiplier: number = 2,\n  ) {\n    super(short_name);\n    this.upgrades = upgrades;\n    this.display_name = display_name;\n    this.description = description;\n    this.production = production;\n    this.production_multiplier = production_multiplier\n  }\n\n  public getDisplayName() {\n    return this.display_name;\n  }\n\n  public getTotalMoneyToNextLevel(): number {\n    //prettier-ignore\n    return this.difficulty_growth_factor *\n    (this.base_gold_per_level + 10 * Math.log(Math.pow(10, this.level / 10)));\n  }\n\n  public requestLevelUp(wallet: Wallet): void {\n    if (!this.active) return;\n\n    if (wallet.money > this.getTotalMoneyToNextLevel()) {\n      wallet.money -= this.getTotalMoneyToNextLevel();\n      this.level++;\n      this.production *= this.production_multiplier;\n    }\n  }\n\n  public update(resources: Resources, delta_t_ms: number): void {\n    if (!this.active) return;\n    \n    this.current_timer_ms += delta_t_ms;\n    while (this.current_timer_ms > this.mine_timer_ms) {\n      // inc resource for the mine\n      this.current_timer_ms -= this.mine_timer_ms;\n      if ((resources as IIndexable)[this.short_name] !== undefined) {\n        (resources as IIndexable)[this.short_name] = (resources as IIndexable)[this.short_name] + this.production\n      }\n    }    \n  }\n}"],"names":[],"mappings":";;;;;MAOa,IAAK,SAAQ,UAAU;IAelC,YACE,UAAgB,EAChB,QAAmB,EACnB,YAAoB,EACpB,WAAmB,EACnB,aAAqB,CAAC,EACtB,wBAAgC,CAAC;QAEjC,KAAK,CAAC,UAAU,CAAC,CAAC;QAlBF,6BAAwB,GAAW,CAAC,CAAC;QACrC,wBAAmB,GAAW,EAAE,CAAC;;QAGlC,WAAM,GAAY,KAAK,CAAC;QACxB,qBAAgB,GAAW,CAAC,CAAC;QAC7B,kBAAa,GAAW,IAAK,CAAC;QAa7C,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QACjC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,IAAI,CAAC,qBAAqB,GAAG,qBAAqB,CAAA;KACnD;IAEM,cAAc;QACnB,OAAO,IAAI,CAAC,YAAY,CAAC;KAC1B;IAEM,wBAAwB;;QAE7B,OAAO,IAAI,CAAC,wBAAwB;aACnC,IAAI,CAAC,mBAAmB,GAAG,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;KAC3E;IAEM,cAAc,CAAC,MAAc;QAClC,IAAI,CAAC,IAAI,CAAC,MAAM;YAAE,OAAO;QAEzB,IAAI,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC,wBAAwB,EAAE,EAAE;YAClD,MAAM,CAAC,KAAK,IAAI,IAAI,CAAC,wBAAwB,EAAE,CAAC;YAChD,IAAI,CAAC,KAAK,EAAE,CAAC;YACb,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,qBAAqB,CAAC;SAC/C;KACF;IAEM,MAAM,CAAC,SAAoB,EAAE,UAAkB;QACpD,IAAI,CAAC,IAAI,CAAC,MAAM;YAAE,OAAO;QAEzB,IAAI,CAAC,gBAAgB,IAAI,UAAU,CAAC;QACpC,OAAO,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,aAAa,EAAE;;YAEjD,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,aAAa,CAAC;YAC5C,IAAK,SAAwB,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,SAAS,EAAE;gBAC3D,SAAwB,CAAC,IAAI,CAAC,UAAU,CAAC,GAAI,SAAwB,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,IAAI,CAAC,UAAU,CAAA;aAC1G;SACF;KACF;CACF;AA9DY;IAAV,OAAO,EAAE;0CAA6B;AAC5B;IAAV,OAAO,EAAE;yCAA4B;AAC3B;IAAV,OAAO,EAAE;sCAA4B;AAE3B;IAAV,OAAO,EAAE;sDAA6C;AAC5C;IAAV,OAAO,EAAE;iDAAyC;AAGzC;IAAT,MAAM,EAAE;oCAAgC;AAC/B;IAAT,MAAM,EAAE;8CAAqC;AACpC;IAAT,MAAM,EAAE;2CAAsC;AACrC;IAAT,MAAM,EAAE;wCAA2B;AAC1B;IAAT,MAAM,EAAE;mDAAsC;;;;"}